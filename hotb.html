<script type="text/worker">
// Automatically updates the number of d6s based on the selected attribute
on("change:roll_virtue change:Strength change:Cunning change:Courage change:Beauty change:Wisdom change:Prowess", function() {
    console.log("Sheet Worker triggered");
    getAttrs(["roll_virtue", "Strength", "Cunning", "Courage", "Beauty", "Wisdom", "Prowess"], function(values) {
        let selectedAttribute = values.roll_virtue;
        let numberOfDice = 0;

        switch (selectedAttribute) {
            case "Strength":
                numberOfDice = parseInt(values.Strength) || 0;
                break;
            // case "dexterity":
            default:
                numberOfDice = parseInt(values.Cunning) + parseInt(values.Strength) || 0;
                break;
            // case "constitution":
            //     numberOfDice = parseInt(values.constitution) || 0;
            //     break;
        }

        // Set the number of d6s to roll
        setAttrs({
            num_of_d6: numberOfDice,
        });
    });
});

const buttonList = ["concept", "devotions", "aspects", "maneuvers", "contacts", "invokes", "equipment", "notes"];
buttonList.forEach(button => {
    on(`clicked:${button}`, function() {
        setAttrs({
            sheetTab: button,
        });
    });
});
</script>
<div>
  <label>Sheet Type:
    <select name="attr_sheetType">
      <option value="pc" selected="true">PC</option>
      <option value="npc">NPC</option>
    </select>
  </label>
</div>
<div class="character">
  <input class="sheet-typetoggle" type="hidden" name="attr_sheetType" value="pc"/>
  <div class="pc">
    <div class="flexCol flexGap10">
      <div class="flexRow flexGap10">
        <div class="flexRow flexGap10">
          <div class="flexCol textAlignCenter"><span>Bear</span><span>Strength</span>
            <input class="textAlignCenter" type="number" name="attr_Strength" value="0"/>
          </div>
          <div class="flexCol textAlignCenter"><span>Elk</span><span>Cunning</span>
            <input class="textAlignCenter" type="number" name="attr_Cunning" value="0"/>
          </div>
          <div class="flexCol textAlignCenter"><span>Falcon</span><span>Courage</span>
            <input class="textAlignCenter" type="number" name="attr_Courage" value="0"/>
          </div>
          <div class="flexCol textAlignCenter"><span>Fox</span><span>Beauty</span>
            <input class="textAlignCenter" type="number" name="attr_Beauty" value="0"/>
          </div>
          <div class="flexCol textAlignCenter"><span>Serpent</span><span>Wisdom</span>
            <input class="textAlignCenter" type="number" name="attr_Wisdom" value="0"/>
          </div>
          <div class="flexCol textAlignCenter"><span>Wolf</span><span>Prowess</span>
            <input class="textAlignCenter" type="number" name="attr_Prowess" value="0"/>
          </div>
        </div>
        <div class="flexCol flexGap10">
          <select name="attr_roll_virtue">
            <option value="Strength">Strength</option>
            <option value="Cunning">Cunning</option>
            <option value="Courage">Courage</option>
            <option value="Beauty">Beauty</option>
            <option value="Wisdom">Wisdom</option>
            <option value="Prowess">Prowess</option>
          </select>
          <input class="invisible" type="number" name="attr_num_of_d6" readonly="true"/>
          <button type="roll" value="/roll @{num_of_d6}d6" name="roll_virtue"></button>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="marginTop50"></div>
<input class="sheet-tabstoggle" type="hidden" name="attr_sheetTab" value="concept"/>
<div class="flexrow"><span>
    <button class="sheet-button0" type="action" name="act_concept">Concept</button></span><span>
    <button class="sheet-button1" type="action" name="act_devotions">Devotions</button></span><span>
    <button class="sheet-button2" type="action" name="act_aspects">Aspects</button></span><span>
    <button class="sheet-button3" type="action" name="act_maneuvers">Maneuvers</button></span><span>
    <button class="sheet-button4" type="action" name="act_contacts">Contacts</button></span><span>
    <button class="sheet-button5" type="action" name="act_invokes">Invokes</button></span><span>
    <button class="sheet-button6" type="action" name="act_equipment">Equipment</button></span><span>
    <button class="sheet-button7" type="action" name="act_notes">Notes</button></span></div>
<div class="sheet-concept">
  <div class="form-group marginTop10">
    <label>House</label>
    <input type="text" name="attr_concept-house"/>
    <label>Family</label>
    <input type="text" name="attr_concept-family"/>
    <label>Public Name</label>
    <input type="text" name="attr_concept-public-name"/>
    <label>Secret Name</label>
    <input type="text" name="attr_concept-secret-name"/>
    <label>Age</label>
    <input type="text" name="attr_concept-age"/>
    <label>Titles</label>
    <input type="text" name="attr_concept-titles"/>
  </div>
</div>
<div class="sheet-devotions">
  <h2>Devotions</h2>
  <fieldset class="repeating_devotion">
    <div class="form-group double-row">
      <label>Name</label>
      <input type="text" name="attr_devotions-name"/>
      <label>Page</label>
      <input type="text" name="attr_devotions-page"/>
    </div>
    <div class="form-group">
      <label>Blessings</label>
      <input type="text" name="attr_devotions-blessings"/>
    </div>
  </fieldset>
</div>
<div class="sheet-aspects">
  <h2>Aspects</h2>
  <fieldset class="repeating_aspect">
    <div class="flexRow flexGap10">
      <input class="sheet-toggle-show" type="checkbox"/>
      <div class="width65">
        <div class="form-group">
          <label>Name</label>
          <input type="text" name="attr_aspects-name"/>
        </div>
        <div class="form-group sheet-body">
          <label>Invoke</label>
          <input type="text" name="attr_aspects-invoke"/>
          <label>Tag</label>
          <input type="text" name="attr_aspects-tag"/>
          <label>Compel</label>
          <input type="text" name="attr_aspects-compel"/>
        </div>
      </div>
    </div>
  </fieldset>
</div>
<div class="sheet-maneuvers">
  <h2>Maneuvers</h2>
  <fieldset class="repeating_aspect">
    <div class="form-group double-row">
      <label>Name</label>
      <input type="text" name="attr_maneuvers-name"/>
      <label>Page</label>
      <input type="text" name="attr_maneuvers-page"/>
    </div>
  </fieldset>
</div>
<div class="sheet-contacts">
  <h2>Contacts</h2>
  <fieldset class="repeating_contact">
    <div class="form-group double-row">
      <label>Name</label>
      <input type="text" name="attr_contacts-name"/>
      <label>Status</label>
      <select name="attr_contacts-status">
        <option value="contact">Contact</option>
        <option value="friend">Friend</option>
      </select>
    </div>
  </fieldset>
</div>
<div class="sheet-invokes">
  <h2>Invokes</h2>
  <fieldset class="repeating_invokes">
    <div class="form-group double-row">
      <label>Name</label>
      <input type="text" name="attr_invokes-name"/>
      <label>Venn</label>
      <input type="text" name="attr_invokes-venn"/>
    </div>
  </fieldset>
</div>
<div class="sheet-equipment">
  <h2>Equipment</h2>
  <div class="flexRow spaceBetween">
    <div>
      <h3>Artifacts</h3>
    </div>
    <div>
      <h3>Items</h3>
      <fieldset class="repeating_items">
        <div class="form-group double-row">
          <label>Name</label>
          <input type="text" name="attr_maneuvers-name"/>
          <label>Page</label>
          <input type="text" name="attr_maneuvers-page"/>
        </div>
      </fieldset>
    </div>
  </div>
</div>
<div class="sheet-notes">
  <h2>Notes</h2>
</div>
